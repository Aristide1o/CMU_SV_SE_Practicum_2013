<html>
	<head>
		<title>Self Timing Test Suite: CSS Operations </title>
		<style>
			.image_style {
				width: 284px; 
				height: 213px;
				//width:300px;
				padding:10px 10px 20px 10px;
				border:1px solid #BFBFBF;
				margin-bottom: 30px;
				float: left;
			}
			td
			{
				padding:6px;
			}
			.default {
				width:320px;
				padding:10px 10px 20px 10px;
				border:1px solid #BFBFBF;
				height: 300px;
				//float: left;
			}
			.movingBlock
			{
				width:80px;
				height:80px;
				background:red;
				position:relative;

			}
			.movingBlock2 {
				width:80px;
				height:80px;
				background:red;
				transition: width 2s, height 2s;
				-webkit-transition:width 2s, height 2s;
			}

			.animationBlock {
				width:80px;
				height:80px;
				background:red;
				animation:testAnimate 5s;
				-webkit-animation:testAnimate 5s; /* Safari and Chrome */
			}

			@keyframes testAnimate
			{
			0%   {background:red; left:0px; top:0px;}
			25%  {background:yellow; left:170px; top:0px;}
			50%  {background:blue; left:170px; top:170px;}
			75%  {background:green; left:0px; top:170px;}
			100% {background:red; left:0px; top:0px;}
			}

			@-webkit-keyframes testAnimate /* Safari and Chrome */
			{
			0%   {background:red; left:0px; top:0px;}
			25%  {background:yellow; left:170px; top:0px;}
			50%  {background:blue; left:170px; top:170px;}
			75%  {background:green; left:0px; top:170px;}
			100% {background:red; left:0px; top:0px;}
			}

			#testResults {
				//float: left;
		    	margin-top: 20px;
				
			}
			button {
				font-size: 13px;
				color: blue;
			}
		</style>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	</head>
	<body>
		<h2>CSS Operations Test Suite</h2>
		<h4>Device Information</h4>
		Enter Device Name: <input type="text" name="device" id="device_name"/>
		
		<table>
			<tr>
				<td>
					Platform: 
				</td>
				<td id="platform"></td>
			</tr>
			<tr>
				<td>
					User Agent: 
				</td>
				<td id="user_agent"></td>
			</tr>
		</table>
		<br/>
		
				
					
				<table>
					<tr>
					<td>	
						<div class="default">
					Test 1. Box-Shadow, Border-Radius, Radius and Shadow, Opacity, Visibility, Image Resize, Overflow:Scroll &nbsp;&nbsp;
					<button type="button" name="test" onclick="suiteOne.run({async: true}); return false;">Run Test 1</button><br/>
					<img id="image" src="teamTahoe.jpg" class="image_style">
						</div>
					<br/>
					</td>
					<td>
						<div class="default">
				    Test 2: Canvas: Object rendering and motion
				    <button type="button" name="test" onclick="suiteTwo.run({async: true}); return false;">Run Test 2</button><br/>
				    <canvas id="canvas"></canvas>
				    <br/>
				    <canvas id="motion_canvas" width="100px" height="100px"></canvas>
				    </div>
				    <br/>
					</td>
					<td>
							<div class="default">
								Test 3: CSS Transforms: Translate, Scale, Rotate and Skew 
							    <button type="button" name="test" onclick="suiteThree.run({async: true}); return false;">Run Test 3</button><br/>
							    <div id="block" class="movingBlock"></div>
							    Transitions: width and height
							    <div id="block2" class="movingBlock2"></div>
				    		</div>
      						<br/>
      					</td>
					
      				</tr>
      				<tr>
      					<td>
							<div class="default">
								Test 4: Animation - position:fixed, position:relative and requestAnimationFrame 
							    <button type="button" name="test" onclick="suiteFour.run({async: true}); return false;">Run Test 4</button><br/>
							    <div id="Block" class="movingBlock"></div>
							    
				    		</div>
      						<br/>
      					</td>
      				</tr>	
      			</table>
				<button type="button" name="upload" onclick="uploadResults();">Upload Results</button><br/>
				<div id="testResults">
					<table id="resultTable" border="1" style="float:left;">
						<th>Results:</th>
						<th><button type="button" name="test" onclick="generateChart();">Generate Chart</button></th>
					</table>
					
					<div id="container" style="min-width: 600px; height: 600px; margin: 0 auto; float:left; margin-left:20px"></div>	
				</div>
		<script src="js/highcharts.js"></script>
		<script src="js/exporting.js"></script>
	
		<script src="js/benchmark.js"></script>
		<!--Test Suite-->
		<script>
			window.requestAnimFrame = (function(){
      		  return  window.requestAnimationFrame       || 
              window.webkitRequestAnimationFrame || 
              window.mozRequestAnimationFrame    || 
              window.oRequestAnimationFrame      || 
              window.msRequestAnimationFrame     || 
              function(/* function */ callback, /* DOMElement */ element){
                window.setTimeout(callback, 1000 / 60);
              };
    })();

			var toggle;
			var suiteOne = new Benchmark.Suite;
			var rotate = 4;
			var context = motion_canvas.getContext( '2d' );
			var results = {};
			var i=0;
			getDeviceInfo();

			suiteOne.add('Box Shadow', function() {
				image.style.WebkitBoxShadow="10px 10px 5px #888888";
			})
			.add('Border Radius', function() {
			  image.style.WebkitBorderRadius="10px";
			})
			.add('Border Radius and Box Shadow', function() {
			  image.style.WebkitBoxShadow="10px 10px 5px #888888";
			  image.style.WebkitBorderRadius="10px";
			})
			.add('Opacity', function() {
				toggle=!toggle;
			  image.style.opacity= toggle ? 0.5 : 0.9;
			})
			.add('Visibility', function() {
				toggle=!toggle;
			  image.style.visibility= toggle ? "hidden" : "visible";
			})
			.add('Image Resize', function() {
				toggle=!toggle;
				image.style.width= toggle ? "284px" : "300px";
			  	image.style.height= toggle ? "213px" : "230px";
			})
			.add('Overflow:Scroll', function() {
			  image.style.overflow="scroll";
			})
			.on('cycle', function(event, bench) {
			  console.log(event.target);
			  image.style.WebkitBorderRadius = "";
  			  image.style.WebkitBoxShadow = "";
  			  image.style.opacity=1;
  			  image.style.visibility="";
  			  image.style.width="284px";
			  image.style.height="213px";
  			  rotate=5;
			  printResults(event.target);
			})
			.on('complete', function() {
			  //document.getElementById("testResults").appendChild(document.createTextNode('Comparison: Fastest is ' + this.filter('fastest').pluck('name')));
			  
			}); 

			var suiteTwo = new Benchmark.Suite;

			suiteTwo.add('Rendering in Canvas', function(){
			  toggle=!toggle;
			  context = canvas.getContext( '2d' );
				context.fillStyle = toggle ? 'rgb(200,200,20)' :  'rgb(20,20,200)';
			  context.fillRect(0,0,100,100);
			})
			.add('Animation in Canvas', function(){
				draw();
			})
			.on('cycle', function(event, bench) {
			  console.log(event.target);

  			  rotate=5;
			  printResults(event.target);
			})
			.on('complete', function() {
			  //document.getElementById("testResults").appendChild(document.createTextNode('Comparison: Fastest is ' + this.filter('fastest').pluck('name')));
			  
			});

			var suiteThree = new Benchmark.Suite;

			suiteThree.add("Transform: Translate(x,y)", function(){
			  rotate+=1;
			  block.style.webkitTransform = "translate("+rotate+"px,"+rotate+"px)"; 
			  if(rotate>=19)
			    rotate=1;

			})
			.add("Transform: scale(x,y)", function(){
			  rotate+=0.1;
			  block.style.webkitTransform = "scale("+rotate+","+rotate+")"; 
			  if(rotate>=6)
			    rotate=0.5;

			})
			.add("Transform: Rotate(angle)", function(){
  				rotate+=2;
  				block.style.webkitTransform = "rotate("+rotate+"deg)"; 

			})
			.add("Transform: Skew(x-angle, y-angle)", function(){
			  rotate+=2;
			  block.style.webkitTransform = "skew("+rotate+"deg,"+rotate+"deg)"; 
			  if(rotate>=25)
			    rotate=5;

			})
			.add("Transition: width, height", function(){
			  block2.style.width="180px";
			  block2.style.height="180px";
			})
			.on('cycle', function(event, bench) {
			  console.log(event.target);

  			  rotate=4;
			  printResults(event.target);
			})
			.on('complete', function() {
			  //document.getElementById("testResults").appendChild(document.createTextNode('Comparison: Fastest is ' + this.filter('fastest').pluck('name')));
			  
			});

			var suiteFour = new Benchmark.Suite;

			suiteFour.add('Position:fixed', function(){
			  Block.style.position = "fixed";
			  Block.className = "animationBlock";
			})
			.add('Position:relative', function(){
			  Block.style.position = "relative";
			  Block.className = "animationBlock";
			})
			.add('requestAnimationFrame', function(){
			 requestAnimFrame( animate );
			  Block.className = "animationBlock";
			})
			.on('cycle', function(event, bench) {
			  console.log(event.target);
			  Block.style.position = "relative";
  			  Block.className = "movingBlock";
			  printResults(event.target);
			})
			.on('complete', function() {
			  //document.getElementById("testResults").appendChild(document.createTextNode('Comparison: Fastest is ' + this.filter('fastest').pluck('name')));
			  
			});

			function draw() {
			    var time = new Date().getTime() * 0.002;
			    var x = Math.sin( time ) * 192 + 256;
			    var y = Math.cos( time * 0.9 ) * 192 + 256;
			    toggle = !toggle;

			    context.fillStyle = toggle ? 'rgb(200,200,20)' :  'rgb(20,20,200)';
			    context.beginPath();
			    context.arc( x, y, 10, 0, Math.PI * 2, true );
			    context.closePath();
			    context.fill();

			}
			function printResults(result){
				var row = document.createElement("tr");
				var cell = document.createElement("td");
				var style_name = result.name;
				var kOpcell = document.createElement("td");
				var avgTime = (result.stats.mean*1000).toFixed(5);
				var kOps = (result.hz/1000).toFixed(3); 

				//populate json
				var style_test = {};
				style_test["name"] = style_name;
				style_test["msTime"] = avgTime;
				style_test["kOps"] = kOps;
				testsArray[i] = style_test;
				i++;
				console.log(results);

			  	var node=document.createTextNode(style_name+ " : Mean Time "+ avgTime +" ms");
				cell.appendChild(node);
				row.appendChild(cell);
				//cell.appendChild(document.createElement("br"));
				kOpcell.appendChild(document.createTextNode("kOps/second: "+ kOps));
				row.appendChild(kOpcell);
				
				var element=document.getElementById("resultTable");
				element.appendChild(row);
			}

			function animate(){}
			function getDeviceInfo(){
				var browserCodeName = navigator.appCodeName;
				var browserName = navigator.appName;
				var browserVersion = navigator.appVersion;
				var platform = navigator.platform;
				var userAgent = navigator.userAgent;
				
				//This will go in  submit results action //
				results['UserAgent'] = userAgent;
				results['Platform'] = platform;
				testsArray = new Array();
				results['tests'] = testsArray;
				//document.getElementById("browser_name").innerHTML = browserName;
				//document.getElementById("code_name").innerHTML = browserCodeName;
				//document.getElementById("browser_version").innerHTML = browserVersion;
				document.getElementById("platform").innerHTML = platform;
				document.getElementById("user_agent").innerHTML = userAgent;
				
			}

			function uploadResults(){
				results['device_name'] = document.getElementById("device_name").value;
		        var url = "http://appception-tahoe.herokuapp.com/environments";

		        //POST, and log the result
		  		$.post(url, results, function(data){console.log(data);}, "json");
			}


			    function generateChart(){  
			    console.log(JSON.stringify(results)); 
			    		var result = {};
			    	$.each(results['tests'], function(index,value){
			    		result[value["name"]]={};
			    		result[value["name"]]["kOps"] = value["kOps"];
			    		result[value["name"]]["msTime"] = value["msTime"];
			    	});


			        //Highcharts code
                    $('#container').highcharts({
                        chart: {
                            type: 'bar'
                        },
                        title: {
                            text: "CSS Operations"
                        },
                        subtitle: {
                            text: results.UserAgent
                        },
                        xAxis: {
                            categories: ['Box-Shadow', 'Border-Radius', 'Border Radius and Box Shadow', 'Opacity', 'Visibility', 'Image Resize', 'Overflow:Scroll', 'Rendering in Canvas','Animation in Canvas', 'Transform: Translate(x,y)', 'Transform: scale(x,y)', 'Transform: Rotate(angle)', 'Transform: Skew(x-angle, y-angle)', 'Transition: width, height'],
                            title: {
                                text: null
                            }
                        },
                        yAxis: {
                            min: 0,
                            title: {
                                text: 'kOps per second',
                                align: 'high'
                            },
                            labels: {
                                overflow: 'justify'
                            }
                        },
                        tooltip: {
                            valueSuffix: ' kOps/s'
                        },
                        plotOptions: {
                            bar: {
                                dataLabels: {
                                    enabled: true
                                }
                            }
                        },
                        legend: {
                            layout: 'vertical',
                            align: 'right',
                            verticalAlign: 'top',
                            x: -100,
                            y: 100,
                            floating: true,
                            borderWidth: 1,
                            backgroundColor: '#FFFFFF',
                            shadow: true
                        },
                        credits: {
                            enabled: false
                        },
                        series: [ {
                            name: 'kOps',
                            data: [Number(result['Box Shadow']['kOps']), Number(result['Border Radius']['kOps']), Number(result['Border Radius and Box Shadow']['kOps']), Number(result['Opacity']['kOps']), Number(result['Visibility']['kOps']), Number(result['Image Resize']['kOps']), Number(result['Overflow:Scroll']['kOps']), Number(result['Rendering in Canvas']['kOps']),Number(result['Animation in Canvas']['kOps']), Number(result['Transform: Translate(x,y)']['kOps']), Number(result['Transform: scale(x,y)']['kOps']), Number(result['Transform: Rotate(angle)']['kOps']), Number(result['Transform: Skew(x-angle, y-angle)']['kOps']), Number(result['Transition: width, height']['kOps'])]
                        }]
                    });//comment out
				}
		</script>
	</body>
</html>